<%
  avatar_source = "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
  avatar_source = url_for(Current.user.avatar_icon) if Current.user.avatar.present?
%>

<% activities = @field.value.merge(Activity.notification_only) %>
<% comments = @field.model.comments.order(created_at: :desc) %>

<% colors = {
  'A'..'E' => '#3498db',
  'F'..'J' => '#1abc9c',
  'K'..'O' => '#f39c12',
  'P'..'T' => '#9b59b6',
  'U'..'Z' => '#e74c3c'
} %>

<div class="max-w-4xl mx-auto py-2 px-2">

<div class="text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:text-gray-400 dark:border-gray-700">
    <ul class="flex flex-wrap -mb-px">
        <li class="me-2">
            <a href="#" class="inline-block p-2 border-b-2 border-blue-600 rounded-t-lg active dark:text-blue-500 dark:border-blue-500" >Kommentare</a>
        </li>
        <li class="me-2">
            <a href="#" class="inline-block p-2  text-blue-600 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300" aria-current="page">Activitäten</a>
        </li>

    </ul>
</div>



  <div class="overflow-y-scroll space-y-4 relative" style="max-height: 400px; overflow: auto">
    <% comments.each do |comment| %>
      <%
        initials = comment.owner.name.split.map(&:first).join.upcase
        color = colors.find { |range, _| range.include?(initials[0]) }&.last || '#7f8c8d'
      %>
      <div class="mb-4 p-4 bg-white shadow ">
        <footer class="flex justify-between items-start pb-2">

            <div class="flex items-center space-x-3 pb-2">
            <div class="inline-flex items-center justify-center w-6 h-6 rounded-full text-xs font-medium" style="background-color: <%= color %>; color: white;">
              <%= initials %>
            </div>
            <p style="text-wrap: nowrap" class="	inline-flex items-center text-sm font-medium text-gray-900 dark:text-white">
              <%= comment.owner.name %>
            </p>
            <p class="text-xs text-gray-500 dark:text-gray-400">
              <time pubdate datetime="<%= comment.created_at.iso8601 %>" title="<%= I18n.l comment.created_at, format: :long %>">
                <%= I18n.l comment.created_at %>
              </time>
            </p>
          </div>
            <div class="ml-auto flex items-center ">
                    <a data-turbo-frame="modal_resource" class=" text-gray-600 h-6 hover:text-gray-600 controll-buttons button-component inline-flex flex-grow-0 items-center font-semibold
                        leading-6 fill-current whitespace-nowrap transition duration-100 transform transition duration-100 cursor-pointer disabled:cursor-not-allowed
                        disabled:opacity-70 justify-center active:outline active:outline-1 rounded px-3 py-1.5 text-sm" href="/resources/comments/10482/edit?modal_resource=true&amp;via_child_resource=CommentResource&amp;via_relation=commentable&amp;via_relation_class=Issue&amp;via_resource_id=100080">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M9.00001 20.2499H4.5C4.30109 20.2499 4.11033 20.1709 3.96967 20.0302C3.82902 19.8896 3.75 19.6988 3.75 19.4999V15.3093C3.74966 15.2119 3.76853 15.1154 3.80553 15.0253C3.84253 14.9352 3.89694 14.8533 3.96563 14.7843L15.2156 3.53429C15.2854 3.46343 15.3686 3.40715 15.4603 3.36874C15.5521 3.33033 15.6506 3.31055 15.75 3.31055C15.8495 3.31055 15.9479 3.33033 16.0397 3.36874C16.1314 3.40715 16.2146 3.46343 16.2844 3.53429L20.4656 7.71554C20.5365 7.78533 20.5928 7.86851 20.6312 7.96026C20.6696 8.052 20.6894 8.15046 20.6894 8.24992C20.6894 8.34938 20.6696 8.44784 20.6312 8.53958C20.5928 8.63132 20.5365 8.71451 20.4656 8.78429L9.00001 20.2499Z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M20.25 20.25H9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M12.75 6L18 11.25" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </a>

                    <form class="flex items-center" data-turbo-frame="has_many_field_show_comments" action="/resources/comments/10482" accept-charset="UTF-8" method="post">
                        <input type="hidden" name="_method" value="delete" autocomplete="off">
                        <input type="hidden" name="authenticity_token" value="xK2wxkPNRvgrFkNzGYWDuuluh-1zYLu-5pCif3bkyMfrVMx6YiePnGu8ldzNm8lo6rwXzKEG7ztN_cBu2lb-Sw" autocomplete="off">
                        <button name="button" type="submit" data-target="control:destroy" data-turbo-confirm="Are you sure?" data-control="destroy" data-resource-id="42" class="controll-buttons">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="text-gray-600 h-6 hover:text-gray-600">
                                <path d="M20.25 5.25H3.75" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                <path d="M9.75 9.75V15.75" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                <path d="M14.25 9.75V15.75" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                <path d="M18.75 5.25V19.5C18.75 19.6989 18.671 19.8897 18.5303 20.0303C18.3897 20.171 18.1989 20.25 18 20.25H6C5.80109 20.25 5.61032 20.171 5.46967 20.0303C5.32902 19.8897 5.25 19.6989 5.25 19.5V5.25" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                <path d="M15.75 5.25V3.75C15.75 3.35218 15.592 2.97064 15.3107 2.68934C15.0294 2.40804 14.6478 2.25 14.25 2.25H9.75C9.35218 2.25 8.97064 2.40804 8.68934 2.68934C8.40804 2.97064 8.25 3.35218 8.25 3.75V5.25" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                        </button>

                        <input value="has_many_field_show_comments" id="turbo_frame_destroy_42" autocomplete="off" type="hidden" name="turbo_frame">
                        <input value="/resources/issues/100080/comments?turbo_frame=has_many_field_show_comments" id="referrer_destroy_42" autocomplete="off" type="hidden" name="referrer">
                    </form>
            </div>
          </footer>




        <div class="flex items-center mb-2">
          <div>
            <span class="text-sm text-gray-800" style="font-family: Inter, ui-sans-serif, system-ui, -apple-system, system-ui; font-feature-settings: normal; font-size: 16px;">
              <%= comment.body.html_safe %>
            </span>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <% initials = Current.user.name.split.map(&:first).join.upcase %>
  <% color = colors.find { |range, _| range.include?(initials[0]) }&.last || '#7f8c8d' %>
</div>

<div class="ml-30 py-4 px-6" data-controller="inline-comment" data-inline-comment-target="commentBox">
  <div class="flex items-center space-x-3 pb-2">
    <div class="inline-flex items-center justify-center w-6 h-6 rounded-full text-sm font-medium" style="background-color: <%= color %>; color: white;">
      <%= initials %>
    </div>
    <input type="text" class="w-full bg-white hover:bg-gray-100 text-gray-900 text-sm rounded px-4 py-2 transition duration-300"
            placeholder="Einen Kommentar hinzufügen ..." data-action="click->inline-comment#showCommentInput" id="comment-input">
    <span class="hidden inline-flex items-center text-sm font-medium text-gray-900 dark:text-white" id="comment-input-label">Kommentar hinzufügen</span>
  </div>

  <div id="comment-area" class="hidden">
    <textarea class="w-full bg-white border rounded p-3 text-gray-800 focus:outline-none focus:ring-1 focus:ring-teal-500 resize-y inline-comment-textarea"
              placeholder="Geben Sie Ihren Kommentar ein!" rows="2" data-inline-comment-target="inlineCommentTextArea"
              data-action="keydown->inline-comment#handleKeydown"></textarea>
    <div class="mt-2 flex justify-end space-x-2">
      <a class="button-component inline-flex flex-grow-0 items-center font-semibold leading-6 fill-current whitespace-nowrap
        transition duration-100 transform transition duration-100 cursor-pointer disabled:cursor-not-allowed disabled:opacity-70
        border justify-center active:outline active:outline-1 rounded text-gray-500 active:outline-gray-500 hover:bg-gray-100
        border-transparent px-3 py-1.5 text-sm" href="#" data-action="click->inline-comment#cancelComment">
        <span>Abbrechen</span>
      </a>
      <button name="button" loading="true" data-action="click->inline-comment#postComment" class="button-component inline-flex flex-grow-0 items-center font-semibold leading-6 fill-current whitespace-nowrap transition duration-100 transform transition duration-100 cursor-pointer disabled:cursor-not-allowed disabled:opacity-70 border justify-center active:outline active:outline-1 rounded bg-primary-500 text-white border-primary-500 hover:bg-primary-600 hover:border-primary-600 active:border-primary-600 active:outline-primary-600 active:bg-primary-600 px-3 py-1.5 text-sm">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 515 450" style="enable-background:new 0 0 515 450;" xml:space="preserve" class="mr-1 h-4 my-1">
          <path d="M438.4,116.4l-72.3-72.3c-7.8-7.8-18.3-12.1-29.2-12.1h-231C83,32,64.5,50.5,64.5,73.4v303.3c0,22.8,18.5,41.4,41.4,41.4h303.3c22.8,0,41.4-18.5,41.4-41.4v-231C450.5,134.7,446.1,124.1,438.4,116.4z M298.9,73.4v68.9H188.6V73.4H298.9z M404,376.6H111c-2.9,0-5.2-2.3-5.2-5.2V78.5c0-2.9,2.3-5.2,5.2-5.2h36.2V163c0,11.4,9.3,20.7,20.7,20.7h151.6c11.4,0,20.7-9.3,20.7-20.7V76.7l67.4,67.4c1,1,1.5,2.3,1.5,3.7v223.7C409.1,374.3,406.8,376.6,404,376.6z M257.5,204.3c-41.8,0-75.8,34-75.8,75.8s34,75.8,75.8,75.8s75.8-34,75.8-75.8S299.3,204.3,257.5,204.3z M257.5,314.6c-19,0-34.5-15.5-34.5-34.5s15.5-34.5,34.5-34.5s34.5,15.5,34.5,34.5S276.5,314.6,257.5,314.6z"></path>
        </svg>
        <span>Speichern</span>
      </button>
    </div>
  </div>
</div>